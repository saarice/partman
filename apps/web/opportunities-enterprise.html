<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Opportunity Management - Partnership Management Platform</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/src/design-system/components/enterprise.css">
    <link rel="stylesheet" href="/src/design-system/components/charts.css">
    <link rel="stylesheet" href="/src/design-system/components/modals.css">
    <link rel="stylesheet" href="/src/styles/opportunities-enterprise.css">

    <!-- Sortable.js for drag-and-drop -->
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.2/Sortable.min.js"></script>

    <!-- Chart.js for analytics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
</head>
<body>
    <!-- Include Lucide Icons -->
    <div id="lucide-icons" style="display: none;"></div>

    <!-- App Shell -->
    <div class="app-shell">
        <!-- Header -->
        <header class="app-header" role="banner">
            <div class="app-header__brand">
                <button id="sidebar-toggle" class="action-menu__trigger" aria-label="Toggle sidebar" aria-expanded="true">
                    <svg class="icon" aria-hidden="true"><use href="#icon-menu"></use></svg>
                </button>
                <h1 class="app-header__title">Partnership Management Platform</h1>
            </div>
            <div class="app-header__actions">
                <button class="action-menu__trigger" aria-label="User menu">
                    <svg class="icon" aria-hidden="true"><use href="#icon-user"></use></svg>
                </button>
            </div>
        </header>

        <!-- Sidebar - Will be replaced by shared navigation -->
        <nav class="app-sidebar" role="navigation" aria-label="Main navigation">
            <div class="app-sidebar__nav">
                <div class="nav-section">
                    <h2 class="nav-section__title">Loading...</h2>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="app-main" role="main">
            <!-- Breadcrumb -->
            <nav class="breadcrumb" aria-label="Breadcrumb">
                <span class="breadcrumb__item">Opportunities</span>
                <span class="breadcrumb__separator" aria-hidden="true">
                    <svg class="icon icon--sm"><use href="#icon-chevron-right"></use></svg>
                </span>
                <span class="breadcrumb__item breadcrumb__item--active" aria-current="page">Pipeline Management</span>
            </nav>

            <!-- Page Header with Actions -->
            <div class="page-header">
                <div class="page-header__content">
                    <h1>Opportunity Pipeline</h1>
                    <p>Track and manage partnership opportunities through the complete sales lifecycle</p>
                </div>
                <div class="page-header__actions">
                    <button class="btn-secondary" id="export-pipeline-btn">
                        <svg class="icon" aria-hidden="true"><use href="#icon-download"></use></svg>
                        Export Pipeline
                    </button>
                    <button class="btn-secondary" id="forecast-btn">
                        <svg class="icon" aria-hidden="true"><use href="#icon-trending-up"></use></svg>
                        Forecast
                    </button>
                    <button class="btn-primary" id="add-opportunity-btn">
                        <svg class="icon" aria-hidden="true"><use href="#icon-plus"></use></svg>
                        Add Opportunity
                    </button>
                </div>
            </div>

            <!-- Pipeline Summary KPIs -->
            <div class="kpi-grid" role="region" aria-label="Pipeline summary metrics">
                <div class="kpi-card">
                    <div class="kpi-card__header">
                        <h2 class="kpi-card__title">Total Pipeline Value</h2>
                        <svg class="icon icon--lg" style="color: var(--color-primary-500);" aria-hidden="true">
                            <use href="#icon-dollar-sign"></use>
                        </svg>
                    </div>
                    <div class="kpi-card__value" id="total-pipeline-value">$8.2M</div>
                    <div class="kpi-card__footer">
                        <div class="trend-indicator trend-indicator--positive">
                            <svg class="icon icon--sm" aria-hidden="true"><use href="#icon-trending-up"></use></svg>
                            +23.5% this quarter
                        </div>
                        <a href="#" class="text-sm" style="color: var(--color-primary-600);" id="view-pipeline-report">View report</a>
                    </div>
                </div>

                <div class="kpi-card">
                    <div class="kpi-card__header">
                        <h2 class="kpi-card__title">Weighted Forecast</h2>
                        <svg class="icon icon--lg" style="color: var(--color-success-500);" aria-hidden="true">
                            <use href="#icon-target"></use>
                        </svg>
                    </div>
                    <div class="kpi-card__value" id="weighted-forecast">$3.4M</div>
                    <div class="kpi-card__footer">
                        <div class="trend-indicator trend-indicator--positive">
                            <svg class="icon icon--sm" aria-hidden="true"><use href="#icon-trending-up"></use></svg>
                            89% confidence
                        </div>
                        <a href="#" class="text-sm" style="color: var(--color-primary-600);">View forecast</a>
                    </div>
                </div>

                <div class="kpi-card">
                    <div class="kpi-card__header">
                        <h2 class="kpi-card__title">Conversion Rate</h2>
                        <svg class="icon icon--lg" style="color: var(--color-warning-500);" aria-hidden="true">
                            <use href="#icon-percent"></use>
                        </svg>
                    </div>
                    <div class="kpi-card__value" id="conversion-rate">34.2%</div>
                    <div class="kpi-card__footer">
                        <div class="trend-indicator trend-indicator--positive">
                            <svg class="icon icon--sm" aria-hidden="true"><use href="#icon-trending-up"></use></svg>
                            +5.7% this quarter
                        </div>
                        <a href="#" class="text-sm" style="color: var(--color-primary-600);">View analysis</a>
                    </div>
                </div>

                <div class="kpi-card">
                    <div class="kpi-card__header">
                        <h2 class="kpi-card__title">Avg. Deal Size</h2>
                        <svg class="icon icon--lg" style="color: var(--color-purple-500);" aria-hidden="true">
                            <use href="#icon-briefcase"></use>
                        </svg>
                    </div>
                    <div class="kpi-card__value" id="avg-deal-size">$92K</div>
                    <div class="kpi-card__footer">
                        <div class="trend-indicator trend-indicator--positive">
                            <svg class="icon icon--sm" aria-hidden="true"><use href="#icon-trending-up"></use></svg>
                            +18% vs target
                        </div>
                        <a href="#" class="text-sm" style="color: var(--color-primary-600);">View breakdown</a>
                    </div>
                </div>
            </div>

            <!-- Filters and View Controls -->
            <div class="pipeline-controls">
                <div class="pipeline-controls__filters">
                    <div class="filter-group">
                        <label class="filter-label">Partner</label>
                        <select class="filter-select" id="partner-filter">
                            <option value="">All Partners</option>
                            <option value="cloudtech">CloudTech Solutions</option>
                            <option value="dataflow">DataFlow Systems</option>
                            <option value="techflow">TechFlow Partners</option>
                            <option value="securedata">SecureData Inc</option>
                            <option value="devops">DevOps Pro</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Assigned To</label>
                        <select class="filter-select" id="assignee-filter">
                            <option value="">All Team Members</option>
                            <option value="sarah">Sarah Chen (Sales)</option>
                            <option value="mike">Mike Rodriguez (Partner)</option>
                            <option value="alex">Alex Kumar (Sales)</option>
                            <option value="jennifer">Jennifer Park (Partner)</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Value Range</label>
                        <select class="filter-select" id="value-filter">
                            <option value="">All Values</option>
                            <option value="small">< $50K</option>
                            <option value="medium">$50K - $200K</option>
                            <option value="large">$200K - $500K</option>
                            <option value="enterprise">> $500K</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Close Date</label>
                        <select class="filter-select" id="date-filter">
                            <option value="">All Dates</option>
                            <option value="overdue">Overdue</option>
                            <option value="thisweek">This Week</option>
                            <option value="thismonth">This Month</option>
                            <option value="nextmonth">Next Month</option>
                            <option value="thisquarter">This Quarter</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <button class="btn-secondary btn--sm" id="reset-filters-btn">
                            <svg class="icon icon--sm" aria-hidden="true"><use href="#icon-refresh-cw"></use></svg>
                            Reset Filters
                        </button>
                    </div>
                </div>
                <div class="pipeline-controls__search">
                    <div class="search-box">
                        <svg class="search-icon" aria-hidden="true"><use href="#icon-search"></use></svg>
                        <input type="text" placeholder="Search opportunities..." id="search-input" class="search-input">
                    </div>
                </div>
                <div class="pipeline-controls__view">
                    <div class="view-toggle">
                        <button class="view-toggle__btn view-toggle__btn--active" data-view="kanban">
                            <svg class="icon" aria-hidden="true"><use href="#icon-columns"></use></svg>
                            Kanban
                        </button>
                        <button class="view-toggle__btn" data-view="table">
                            <svg class="icon" aria-hidden="true"><use href="#icon-table"></use></svg>
                            Table
                        </button>
                        <button class="view-toggle__btn" data-view="analytics">
                            <svg class="icon" aria-hidden="true"><use href="#icon-bar-chart-3"></use></svg>
                            Analytics
                        </button>
                    </div>
                </div>
            </div>

            <!-- Kanban Board View -->
            <div id="kanban-view" class="pipeline-view">
                <div class="kanban-board">
                    <!-- Lead Stage -->
                    <div class="kanban-column" data-stage="lead">
                        <div class="kanban-header">
                            <div class="kanban-header__title">
                                <span class="stage-indicator stage-indicator--lead"></span>
                                Lead
                                <span class="stage-count" id="lead-count">23</span>
                            </div>
                            <div class="kanban-header__value" id="lead-value">$1.2M</div>
                        </div>
                        <div class="kanban-body" id="lead-column">
                            <!-- Opportunity cards will be inserted here -->
                        </div>
                    </div>

                    <!-- Demo Stage -->
                    <div class="kanban-column" data-stage="demo">
                        <div class="kanban-header">
                            <div class="kanban-header__title">
                                <span class="stage-indicator stage-indicator--demo"></span>
                                Demo
                                <span class="stage-count" id="demo-count">18</span>
                            </div>
                            <div class="kanban-header__value" id="demo-value">$950K</div>
                        </div>
                        <div class="kanban-body" id="demo-column">
                            <!-- Opportunity cards will be inserted here -->
                        </div>
                    </div>

                    <!-- POC Stage -->
                    <div class="kanban-column" data-stage="poc">
                        <div class="kanban-header">
                            <div class="kanban-header__title">
                                <span class="stage-indicator stage-indicator--poc"></span>
                                POC
                                <span class="stage-count" id="poc-count">15</span>
                            </div>
                            <div class="kanban-header__value" id="poc-value">$1.8M</div>
                        </div>
                        <div class="kanban-body" id="poc-column">
                            <!-- Opportunity cards will be inserted here -->
                        </div>
                    </div>

                    <!-- Proposal Stage -->
                    <div class="kanban-column" data-stage="proposal">
                        <div class="kanban-header">
                            <div class="kanban-header__title">
                                <span class="stage-indicator stage-indicator--proposal"></span>
                                Proposal
                                <span class="stage-count" id="proposal-count">12</span>
                            </div>
                            <div class="kanban-header__value" id="proposal-value">$2.1M</div>
                        </div>
                        <div class="kanban-body" id="proposal-column">
                            <!-- Opportunity cards will be inserted here -->
                        </div>
                    </div>

                    <!-- Closed Won Stage -->
                    <div class="kanban-column" data-stage="closed_won">
                        <div class="kanban-header">
                            <div class="kanban-header__title">
                                <span class="stage-indicator stage-indicator--won"></span>
                                Closed Won
                                <span class="stage-count" id="won-count">31</span>
                            </div>
                            <div class="kanban-header__value" id="won-value">$3.4M</div>
                        </div>
                        <div class="kanban-body" id="won-column">
                            <!-- Opportunity cards will be inserted here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Table View -->
            <div id="table-view" class="pipeline-view" style="display: none;">
                <div class="data-table-container">
                    <table class="data-table" role="table">
                        <thead class="data-table__header">
                            <tr role="row">
                                <th role="columnheader" class="sortable" data-sort="customerName">
                                    Customer
                                    <svg class="sort-icon" aria-hidden="true"><use href="#icon-chevrons-up-down"></use></svg>
                                </th>
                                <th role="columnheader" class="sortable" data-sort="partnerName">
                                    Partner
                                    <svg class="sort-icon" aria-hidden="true"><use href="#icon-chevrons-up-down"></use></svg>
                                </th>
                                <th role="columnheader" class="sortable" data-sort="dealValue">
                                    Value
                                    <svg class="sort-icon" aria-hidden="true"><use href="#icon-chevrons-up-down"></use></svg>
                                </th>
                                <th role="columnheader" class="sortable" data-sort="stage">
                                    Stage
                                    <svg class="sort-icon" aria-hidden="true"><use href="#icon-chevrons-up-down"></use></svg>
                                </th>
                                <th role="columnheader" class="sortable" data-sort="probability">
                                    Probability
                                    <svg class="sort-icon" aria-hidden="true"><use href="#icon-chevrons-up-down"></use></svg>
                                </th>
                                <th role="columnheader" class="sortable" data-sort="expectedCloseDate">
                                    Close Date
                                    <svg class="sort-icon" aria-hidden="true"><use href="#icon-chevrons-up-down"></use></svg>
                                </th>
                                <th role="columnheader">Actions</th>
                            </tr>
                        </thead>
                        <tbody class="data-table__body" id="opportunities-table-body">
                            <!-- Table rows will be inserted here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Analytics View -->
            <div id="analytics-view" class="pipeline-view" style="display: none;">
                <div class="analytics-grid">
                    <!-- Pipeline Velocity Chart -->
                    <div class="chart-container">
                        <div class="chart-header">
                            <div>
                                <h2 class="chart-title">Pipeline Velocity</h2>
                                <p class="chart-subtitle">Average time spent in each stage</p>
                            </div>
                        </div>
                        <div class="chart-canvas-container">
                            <canvas id="velocity-chart"></canvas>
                        </div>
                    </div>

                    <!-- Conversion Funnel -->
                    <div class="chart-container">
                        <div class="chart-header">
                            <div>
                                <h2 class="chart-title">Conversion Funnel</h2>
                                <p class="chart-subtitle">Opportunity progression rates</p>
                            </div>
                        </div>
                        <div class="chart-canvas-container">
                            <canvas id="funnel-chart"></canvas>
                        </div>
                    </div>

                    <!-- Revenue Forecast -->
                    <div class="chart-container chart-container--wide">
                        <div class="chart-header">
                            <div>
                                <h2 class="chart-title">Revenue Forecast</h2>
                                <p class="chart-subtitle">Weighted pipeline projections with confidence intervals</p>
                            </div>
                            <div class="chart-actions">
                                <select class="chart-period-select" id="forecast-period">
                                    <option value="quarter">This Quarter</option>
                                    <option value="year">This Year</option>
                                    <option value="next6">Next 6 Months</option>
                                </select>
                            </div>
                        </div>
                        <div class="chart-canvas-container">
                            <canvas id="forecast-chart"></canvas>
                        </div>
                    </div>

                    <!-- Win/Loss Analysis -->
                    <div class="chart-container">
                        <div class="chart-header">
                            <div>
                                <h2 class="chart-title">Win/Loss Analysis</h2>
                                <p class="chart-subtitle">Closed opportunity outcomes</p>
                            </div>
                        </div>
                        <div class="chart-canvas-container">
                            <canvas id="winloss-chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Add/Edit Opportunity Modal -->
    <div class="modal" id="opportunity-modal" style="display: none;">
        <div class="modal__container modal__container--large">
            <div class="modal__header">
                <h2 class="modal__title" id="modal-title">Add New Opportunity</h2>
                <button class="modal__close" aria-label="Close modal">
                    <svg class="icon" aria-hidden="true"><use href="#icon-x"></use></svg>
                </button>
            </div>
            <div class="modal__body">
                <form id="opportunity-form" class="opportunity-form">
                    <div class="form-grid">
                        <!-- Customer Information -->
                        <div class="form-section">
                            <h3 class="form-section__title">Customer Information</h3>
                            <div class="form-group">
                                <label class="form-label" for="customer-name">Customer Name *</label>
                                <input type="text" id="customer-name" name="customerName" class="form-input" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="customer-contact-name">Contact Name</label>
                                <input type="text" id="customer-contact-name" name="contactName" class="form-input">
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="customer-email">Contact Email</label>
                                <input type="email" id="customer-email" name="contactEmail" class="form-input">
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="customer-company">Company</label>
                                <input type="text" id="customer-company" name="contactCompany" class="form-input">
                            </div>
                        </div>

                        <!-- Deal Information -->
                        <div class="form-section">
                            <h3 class="form-section__title">Deal Information</h3>
                            <div class="form-group">
                                <label class="form-label" for="partner-select">Partner *</label>
                                <select id="partner-select" name="partnerId" class="form-select" required>
                                    <option value="">Select Partner</option>
                                    <option value="cloudtech">CloudTech Solutions</option>
                                    <option value="dataflow">DataFlow Systems</option>
                                    <option value="techflow">TechFlow Partners</option>
                                    <option value="securedata">SecureData Inc</option>
                                    <option value="devops">DevOps Pro</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="deal-value">Deal Value ($) *</label>
                                <input type="number" id="deal-value" name="dealValue" class="form-input" min="0" step="1000" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="stage-select">Stage *</label>
                                <select id="stage-select" name="stage" class="form-select" required>
                                    <option value="lead">Lead (10%)</option>
                                    <option value="demo">Demo (25%)</option>
                                    <option value="poc">POC (50%)</option>
                                    <option value="proposal">Proposal (75%)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="probability">Probability (%)</label>
                                <input type="number" id="probability" name="probability" class="form-input" min="0" max="100" step="5">
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="close-date">Expected Close Date *</label>
                                <input type="date" id="close-date" name="expectedCloseDate" class="form-input" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="assigned-user">Assigned To</label>
                                <select id="assigned-user" name="assignedUserId" class="form-select">
                                    <option value="">Unassigned</option>
                                    <option value="sarah">Sarah Chen (Sales)</option>
                                    <option value="mike">Mike Rodriguez (Partner)</option>
                                    <option value="alex">Alex Kumar (Sales)</option>
                                    <option value="jennifer">Jennifer Park (Partner)</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Notes Section -->
                    <div class="form-section">
                        <h3 class="form-section__title">Additional Information</h3>
                        <div class="form-group">
                            <label class="form-label" for="opportunity-notes">Notes</label>
                            <textarea id="opportunity-notes" name="notes" class="form-textarea" rows="4" placeholder="Add any relevant notes, requirements, or next steps..."></textarea>
                        </div>
                    </div>

                    <!-- Commission Preview (Auto-calculated) -->
                    <div class="form-section" id="commission-preview" style="display: none;">
                        <h3 class="form-section__title">Commission Preview</h3>
                        <div class="commission-summary">
                            <div class="commission-item">
                                <span class="commission-label">Estimated Commission:</span>
                                <span class="commission-value" id="estimated-commission">$0</span>
                            </div>
                            <div class="commission-item">
                                <span class="commission-label">Commission Rate:</span>
                                <span class="commission-value" id="commission-rate">5%</span>
                            </div>
                            <div class="commission-item">
                                <span class="commission-label">Weighted Value:</span>
                                <span class="commission-value" id="weighted-value">$0</span>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal__footer">
                <button type="button" class="btn-secondary" id="cancel-opportunity">Cancel</button>
                <button type="submit" form="opportunity-form" class="btn-primary" id="save-opportunity">
                    <span id="save-text">Save Opportunity</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Forecast Modal -->
    <div class="modal" id="forecast-modal" style="display: none;">
        <div class="modal__container modal__container--large">
            <div class="modal__header">
                <h2 class="modal__title">Revenue Forecast & Scenario Planning</h2>
                <button class="modal__close" aria-label="Close modal">
                    <svg class="icon" aria-hidden="true"><use href="#icon-x"></use></svg>
                </button>
            </div>
            <div class="modal__body">
                <div class="forecast-content">
                    <div class="forecast-scenarios">
                        <div class="scenario-card">
                            <h4>Conservative</h4>
                            <div class="scenario-value" id="conservative-forecast">$2.1M</div>
                            <div class="scenario-probability">75% Confidence</div>
                        </div>
                        <div class="scenario-card scenario-card--primary">
                            <h4>Most Likely</h4>
                            <div class="scenario-value" id="likely-forecast">$3.4M</div>
                            <div class="scenario-probability">50% Confidence</div>
                        </div>
                        <div class="scenario-card">
                            <h4>Optimistic</h4>
                            <div class="scenario-value" id="optimistic-forecast">$4.7M</div>
                            <div class="scenario-probability">25% Confidence</div>
                        </div>
                    </div>
                    <div class="forecast-chart-container">
                        <canvas id="scenario-chart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Opportunity Detail Modal -->
    <div class="modal" id="detail-modal" style="display: none;">
        <div class="modal__container modal__container--large">
            <div class="modal__header">
                <h2 class="modal__title" id="detail-title">Opportunity Details</h2>
                <div class="modal__actions">
                    <button class="btn-secondary btn-secondary--sm" id="edit-opportunity">
                        <svg class="icon icon--sm" aria-hidden="true"><use href="#icon-edit-3"></use></svg>
                        Edit
                    </button>
                    <button class="btn-danger btn-danger--sm" id="delete-opportunity">
                        <svg class="icon icon--sm" aria-hidden="true"><use href="#icon-trash-2"></use></svg>
                        Delete
                    </button>
                </div>
                <button class="modal__close" aria-label="Close modal">
                    <svg class="icon" aria-hidden="true"><use href="#icon-x"></use></svg>
                </button>
            </div>
            <div class="modal__body">
                <div class="detail-content" id="detail-content">
                    <!-- Opportunity details will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Pipeline Report Modal -->
    <div class="modal" id="pipeline-report-modal" style="display: none;">
        <div class="modal__container modal__container--xlarge">
            <div class="modal__header">
                <h2 class="modal__title">Pipeline Value Report</h2>
                <button class="modal__close" aria-label="Close modal">
                    <svg class="icon" aria-hidden="true"><use href="#icon-x"></use></svg>
                </button>
            </div>
            <div class="modal__body">
                <div class="report-content">
                    <!-- Report Summary -->
                    <div class="report-section">
                        <h3 class="report-section__title">Executive Summary</h3>
                        <div class="report-summary-grid">
                            <div class="summary-card">
                                <div class="summary-card__label">Total Pipeline Value</div>
                                <div class="summary-card__value" id="report-total-value">$8.2M</div>
                            </div>
                            <div class="summary-card">
                                <div class="summary-card__label">Weighted Forecast</div>
                                <div class="summary-card__value" id="report-weighted-value">$4.8M</div>
                            </div>
                            <div class="summary-card">
                                <div class="summary-card__label">Active Opportunities</div>
                                <div class="summary-card__value" id="report-active-count">127</div>
                            </div>
                            <div class="summary-card">
                                <div class="summary-card__label">Average Deal Size</div>
                                <div class="summary-card__value" id="report-avg-deal">$64.6K</div>
                            </div>
                        </div>
                    </div>

                    <!-- Breakdown by Stage -->
                    <div class="report-section">
                        <h3 class="report-section__title">Pipeline by Stage</h3>
                        <div class="stage-breakdown-table">
                            <table class="report-table">
                                <thead>
                                    <tr>
                                        <th>Stage</th>
                                        <th>Opportunities</th>
                                        <th>Total Value</th>
                                        <th>Weighted Value</th>
                                        <th>Avg Deal Size</th>
                                    </tr>
                                </thead>
                                <tbody id="stage-breakdown-body">
                                    <!-- Stage breakdown rows will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Breakdown by Partner -->
                    <div class="report-section">
                        <h3 class="report-section__title">Pipeline by Partner</h3>
                        <div class="partner-breakdown-table">
                            <table class="report-table">
                                <thead>
                                    <tr>
                                        <th>Partner</th>
                                        <th>Opportunities</th>
                                        <th>Total Value</th>
                                        <th>Win Rate</th>
                                        <th>Avg Deal Size</th>
                                    </tr>
                                </thead>
                                <tbody id="partner-breakdown-body">
                                    <!-- Partner breakdown rows will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Time Analysis -->
                    <div class="report-section">
                        <h3 class="report-section__title">Time Analysis</h3>
                        <div class="time-analysis-grid">
                            <div class="time-card">
                                <div class="time-card__label">Opportunities Closing This Month</div>
                                <div class="time-card__value" id="report-this-month">$1.2M</div>
                                <div class="time-card__count" id="report-this-month-count">12 opportunities</div>
                            </div>
                            <div class="time-card">
                                <div class="time-card__label">Opportunities Closing Next Month</div>
                                <div class="time-card__value" id="report-next-month">$2.1M</div>
                                <div class="time-card__count" id="report-next-month-count">18 opportunities</div>
                            </div>
                            <div class="time-card">
                                <div class="time-card__label">Overdue Opportunities</div>
                                <div class="time-card__value" id="report-overdue">$850K</div>
                                <div class="time-card__count" id="report-overdue-count">7 opportunities</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal__footer">
                <button type="button" class="btn-secondary" onclick="document.getElementById('pipeline-report-modal').style.display = 'none'">Close</button>
                <button type="button" class="btn-primary" id="export-report-btn">
                    <svg class="icon icon--sm" aria-hidden="true"><use href="#icon-download"></use></svg>
                    Export Report
                </button>
            </div>
        </div>
    </div>

    <!-- Notification Container -->
    <div id="notification-container" class="notification-container" aria-live="polite"></div>

    <!-- Load Shared Navigation -->
    <script src="/src/shared/navigation.js"></script>

    <!-- Opportunity Management Script -->
    <script src="/src/js/opportunity-management.js"></script>

    <script>
        // Load icons first
        fetch('/src/design-system/icons/lucide-icons.svg')
            .then(response => response.text())
            .then(svgContent => {
                document.getElementById('lucide-icons').innerHTML = svgContent;
            })
            .catch(error => {
                console.warn('Could not load icons:', error);
            });

        // Notification system
        function showNotification(message, type = 'info') {
            const container = document.getElementById('notification-container');
            const notification = document.createElement('div');

            notification.className = `notification notification--${type}`;
            notification.innerHTML = `
                <div class="notification__content">
                    <svg class="notification__icon" aria-hidden="true">
                        <use href="#icon-check-circle-2"></use>
                    </svg>
                    <span class="notification__message">${message}</span>
                </div>
                <button class="notification__close" aria-label="Close notification">
                    <svg class="icon icon--sm" aria-hidden="true">
                        <use href="#icon-x"></use>
                    </svg>
                </button>
            `;

            container.appendChild(notification);

            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 5000);

            notification.querySelector('.notification__close').addEventListener('click', function() {
                notification.parentNode.removeChild(notification);
            });
        }

        // Global notification function
        window.showNotification = showNotification;

        // Debug: Check if OpportunityManager initializes
        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOM loaded, checking OpportunityManager...');

            // Test Sortable.js directly
            setTimeout(() => {
                console.log('🧪 TESTING SORTABLE.JS DIRECTLY');
                console.log('Sortable available:', typeof window.Sortable);

                if (typeof window.Sortable !== 'undefined') {
                    const testElement = document.getElementById('lead-column');
                    if (testElement) {
                        console.log('🧪 Creating test Sortable on lead-column...');
                        try {
                            const testSortable = new window.Sortable(testElement, {
                                group: 'test',
                                onEnd: (evt) => {
                                    console.log('🧪 TEST DRAG WORKED!', evt.item.dataset.opportunityId);
                                }
                            });
                            console.log('✅ Test Sortable created successfully');
                        } catch (error) {
                            console.error('❌ Test Sortable failed:', error);
                        }
                    } else {
                        console.error('❌ lead-column not found for test');
                    }
                }

                if (window.opportunityManager) {
                    console.log('✅ OpportunityManager initialized:', window.opportunityManager);
                } else {
                    console.error('❌ OpportunityManager not found! Check script loading.');
                }
            }, 500);
        });
    </script>
</body>
</html>
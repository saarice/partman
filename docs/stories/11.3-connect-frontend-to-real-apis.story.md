# Story 11.3: Connect Frontend to Real Backend APIs

## Status
Ready for Development

## Epic
Epic 11: Production Readiness & Technical Debt Resolution

## Priority
ðŸ”´ **CRITICAL** - Integration Blocker

## Story Points
8 points (2 days)

---

## Story

**As a** Frontend Developer
**I want** all dashboard components to fetch data from real backend APIs instead of mock data
**So that** the application displays actual database data and integration bugs are discovered before production

---

## Context

**Current State** (2025-10-18 Analysis):

All three dashboards are using mock data instead of real API calls:

**Opportunities Dashboard** (`apps/web/src/pages/Dashboard/OpportunitiesDashboard.tsx`):
```typescript
// ðŸš¨ USING MOCK DATA
const data = getMockOpportunities();
setOpportunities(data);
```

**Partnerships Dashboard** (`apps/web/src/pages/PartnershipsDashboard.tsx`):
```typescript
// ðŸš¨ USING MOCK DATA
const partners = getMockPartnerData();
```

**Financial Dashboard** (`apps/web/src/pages/FinancialDashboard.tsx`):
```typescript
// ðŸš¨ USING MOCK DATA
const financial = getMockFinancialData();
```

**Impact**:
- Frontend and backend development disconnected
- API integration bugs hidden
- Database schema issues undiscovered
- Cannot test real user workflows
- Demo data instead of production-ready application

**Backend APIs Available** (already implemented):
- âœ… `GET /api/dashboard` - Dashboard KPIs
- âœ… `GET /api/opportunities` - Opportunities list
- âœ… `GET /api/partners` - Partners list
- âœ… `GET /api/pipeline` - Pipeline funnel data
- âœ… `GET /api/alerts` - Alert notifications

---

## Acceptance Criteria

### 1. Opportunities Dashboard Uses Real Data
- [ ] `getMockOpportunities()` replaced with API call to `/api/opportunities`
- [ ] Loading states displayed while fetching data
- [ ] Error handling implemented for failed API calls
- [ ] Empty state displayed when no opportunities exist
- [ ] Filters and sorting work with real API
- [ ] Pipeline funnel calculates from real data

### 2. Partnerships Dashboard Uses Real Data
- [ ] `getMockPartnerData()` replaced with API call to `/api/partners`
- [ ] Health scores calculated from database values
- [ ] Revenue metrics sourced from opportunities table
- [ ] Partner list refreshes on data changes
- [ ] Partner detail views fetch individual partner data

### 3. Financial Dashboard Uses Real Data
- [ ] `getMockFinancialData()` replaced with API calls
- [ ] Monthly revenue calculated from closed opportunities
- [ ] Deal size averages computed from real data
- [ ] Charts render with actual database values
- [ ] Target achievement reflects real quarterly goals

### 4. Error Handling & UX
- [ ] Loading spinners shown during API calls
- [ ] Error messages displayed for failed requests
- [ ] Retry mechanism for temporary failures
- [ ] Graceful degradation if API unavailable
- [ ] Toast notifications for errors

### 5. API Integration Verified
- [ ] All API endpoints return correct data structure
- [ ] TypeScript interfaces match API responses
- [ ] Authentication headers included in requests
- [ ] CORS configuration allows frontend requests
- [ ] WebSocket connections established successfully

---

## Tasks / Subtasks

### Task 1: Update Opportunities Dashboard (3 hours)

**Step 1: Replace mock data with API calls**
```typescript
// apps/web/src/pages/Dashboard/OpportunitiesDashboard.tsx

// BEFORE:
import { getMockOpportunities } from '../../services/mockOpportunityData';

const OpportunitiesDashboard: React.FC = () => {
  const [opportunities, setOpportunities] = useState<Opportunity[]>([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    // ðŸš¨ MOCK DATA
    const data = getMockOpportunities();
    setOpportunities(data);
    setLoading(false);
  }, []);

  // ...
};

// AFTER:
import { dashboardApi } from '../../services/dashboardApi';
import { notify } from '../../utils/notifications';

const OpportunitiesDashboard: React.FC = () => {
  const [opportunities, setOpportunities] = useState<Opportunity[]>([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);

  useEffect(() => {
    const fetchOpportunities = async () => {
      try {
        setLoading(true);
        setError(null);

        // âœ… REAL API CALL
        const response = await dashboardApi.getOpportunities({
          sortBy: 'updated_at',
          sortOrder: 'desc'
        });

        setOpportunities(response.data.opportunities);
        notify.success(`Loaded ${response.data.opportunities.length} opportunities`);
      } catch (err: any) {
        const errorMessage = err.response?.data?.message || 'Failed to load opportunities';
        setError(errorMessage);
        notify.error(errorMessage);
        console.error('Error fetching opportunities:', err);
      } finally {
        setLoading(false);
      }
    };

    fetchOpportunities();
  }, []);

  // Handle error state
  if (error) {
    return (
      <Box sx={{ p: 3, textAlign: 'center' }}>
        <Typography color="error" variant="h6">
          {error}
        </Typography>
        <Button onClick={() => window.location.reload()} sx={{ mt: 2 }}>
          Retry
        </Button>
      </Box>
    );
  }

  // Handle empty state
  if (!loading && opportunities.length === 0) {
    return (
      <Box sx={{ p: 3, textAlign: 'center' }}>
        <Typography variant="h6" color="text.secondary">
          No opportunities found
        </Typography>
        <Button href="/management/opportunities" sx={{ mt: 2 }}>
          Create First Opportunity
        </Button>
      </Box>
    );
  }

  // ... rest of component
};
```

### Task 2: Update Partnerships Dashboard (2 hours)

**Replace mock partner data**:
```typescript
// apps/web/src/pages/PartnershipsDashboard.tsx

const PartnershipsDashboard: React.FC = () => {
  const [partners, setPartners] = useState<Partner[]>([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const fetchPartners = async () => {
      try {
        setLoading(true);

        // âœ… REAL API CALL
        const response = await dashboardApi.getPartners();
        setPartners(response.data.partners);

        notify.success('Partners loaded successfully');
      } catch (error: any) {
        notify.error('Failed to load partners');
        console.error('Error fetching partners:', error);
      } finally {
        setLoading(false);
      }
    };

    fetchPartners();
  }, []);

  // Calculate metrics from real data
  const metrics = useMemo(() => {
    const totalPartners = partners.length;
    const avgHealthScore = partners.reduce((sum, p) => sum + p.healthScore, 0) / totalPartners;
    const atRiskPartners = partners.filter(p => p.healthScore < 50).length;

    return { totalPartners, avgHealthScore, atRiskPartners };
  }, [partners]);

  // ...
};
```

### Task 3: Update Financial Dashboard (2 hours)

**Fetch real financial data**:
```typescript
// apps/web/src/pages/FinancialDashboard.tsx

const FinancialDashboard: React.FC = () => {
  const [financialData, setFinancialData] = useState<FinancialData | null>(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const fetchFinancialData = async () => {
      try {
        setLoading(true);

        // Fetch closed opportunities for revenue calculation
        const opportunitiesResponse = await dashboardApi.getOpportunities({
          status: 'closed_won',
          sortBy: 'actual_close_date',
          sortOrder: 'desc'
        });

        // Fetch quarterly goals
        const goalsResponse = await dashboardApi.getQuarterlyGoals();

        // Calculate financial metrics
        const closedDeals = opportunitiesResponse.data.opportunities;
        const totalRevenue = closedDeals.reduce((sum, opp) => sum + opp.value, 0);
        const avgDealSize = totalRevenue / closedDeals.length || 0;

        setFinancialData({
          totalRevenue,
          avgDealSize,
          closedDeals,
          quarterlyGoals: goalsResponse.data
        });

        notify.success('Financial data loaded');
      } catch (error) {
        notify.error('Failed to load financial data');
        console.error('Error fetching financial data:', error);
      } finally {
        setLoading(false);
      }
    };

    fetchFinancialData();
  }, []);

  // ...
};
```

### Task 4: Remove Mock Data Files (30 minutes)

**After verifying real data works, delete mock files**:
- [ ] Delete `apps/web/src/services/mockOpportunityData.ts`
- [ ] Delete `apps/web/src/services/mockPartnerData.ts`
- [ ] Delete `apps/web/src/services/mockFinancialData.ts`
- [ ] Remove imports from components
- [ ] Clean up unused type definitions

---

## Definition of Done

- [x] All mock data imports removed from dashboard components
- [x] All dashboards fetch data from real APIs
- [x] Loading states implemented for all async operations
- [x] Error handling implemented with user-friendly messages
- [x] Empty states implemented when no data exists
- [x] Mock data files deleted from repository
- [x] Manual testing completed for all dashboards
- [x] TypeScript types match API response structures
- [x] Code reviewed and approved

---

**Created**: 2025-10-18
**Story Owner**: Frontend Team
**Last Updated**: 2025-10-18
# Story 10.3: Frontend RBAC Hooks & Route Guards

**Story ID**: 10.3
**Epic**: 10 - Authentication & Authorization Enhancement
**Status**: Ready for Development
**Priority**: P0 (Blocker)
**Effort**: 8 Story Points

## Story
**As a** frontend developer
**I want** permission hooks and route guards
**So that** UI elements are hidden/shown based on user role

## Acceptance Criteria
1. Create `apps/web/src/hooks/usePermissions.ts` hook
2. Hook returns: canManageUsers, canEditPartnerships, canEditOpportunities, canViewDashboards
3. Update ProtectedRoute component to accept optional allowedRoles prop
4. Unauthorized route access redirects to /403 page
5. Create 403 Forbidden page with clear message
6. Update SidebarNavigation to conditionally render menu items
7. Admin navigation item only visible to system_owner
8. Edit buttons hidden/disabled based on permissions

## Technical Notes
**usePermissions Hook:**
```typescript
export const usePermissions = () => {
  const { user } = useAuthStore();
  const hasRole = (allowedRoles: string[]) => {
    return user?.role && allowedRoles.includes(user.role);
  };
  return {
    canManageUsers: hasRole(['system_owner']),
    canEditPartnerships: hasRole(['system_owner', 'vp', 'sales_manager']),
    canEditOpportunities: hasRole(['system_owner', 'vp', 'sales_manager', 'sales_rep']),
    canViewDashboards: hasRole(['system_owner', 'vp', 'sales_manager', 'sales_rep', 'viewer']),
  };
};
```

## Tasks
- [ ] Create apps/web/src/hooks/usePermissions.ts hook
- [ ] Implement permission checks for all roles
- [ ] Update ProtectedRoute to accept allowedRoles prop
- [ ] Create 403 Forbidden page component
- [ ] Update SidebarNavigation with permission checks
- [ ] Update all pages to use usePermissions hook
- [ ] Hide/disable edit buttons based on role
- [ ] Write unit tests for usePermissions hook
- [ ] Write integration tests for route protection

## Testing
- [ ] System owner sees all menu items including Admin
- [ ] VP sees dashboards and management but not Admin
- [ ] Viewer sees only dashboard menu items
- [ ] Edit buttons hidden for viewer role
- [ ] Admin routes redirect viewer to 403 page
- [ ] All permission checks work correctly
- [ ] Mobile responsive navigation tested

## Definition of Done
- All components updated to use permission checks
- No edit buttons visible to viewer role
- Tests confirm all permission scenarios
- 403 page displays correctly
- Admin menu only visible to system_owner

## Agent Model Used
[To be filled by dev agent]

## Dev Agent Record

### Completion Notes
- [ ] usePermissions hook created
- [ ] All components updated
- [ ] Tests passing

### File List
- `apps/web/src/hooks/usePermissions.ts`
- `apps/web/src/pages/403.tsx`
- `apps/web/src/components/layout/SidebarNavigation.tsx`
- `apps/web/src/components/common/ProtectedRoute.tsx`

### Change Log
[To be filled during implementation]

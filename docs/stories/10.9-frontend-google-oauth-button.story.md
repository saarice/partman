# Story 10.9: Frontend Google OAuth Button & Callback

**Story ID**: 10.9
**Epic**: 10 - Authentication & Authorization Enhancement
**Status**: Ready for Development
**Priority**: P0 (Blocker)
**Effort**: 5 Story Points

## Story
**As a** user
**I want** a "Sign in with Google" button
**So that** I can login without typing credentials

## Acceptance Criteria
1. Login page displays "Sign in with Google" button below password login
2. Button styled with Google branding guidelines (white background, blue text, Google logo)
3. Button click generates PKCE code_verifier and code_challenge
4. Button redirects to Google OAuth consent screen
5. OAuth callback route /auth/google/callback handles response
6. Callback extracts authorization code from URL params
7. Callback calls POST /api/auth/google/callback with code and codeVerifier
8. On success, stores tokens in authStore and redirects to /dashboard
9. On error, displays error message and stays on login page
10. PKCE code_verifier stored in sessionStorage during OAuth flow

## Technical Notes
**PKCE Implementation:**
```typescript
// Generate code verifier (random string)
const codeVerifier = crypto.randomBytes(32).toString('base64url');

// Generate code challenge (SHA256 hash)
const encoder = new TextEncoder();
const data = encoder.encode(codeVerifier);
const hash = await crypto.subtle.digest('SHA-256', data);
const codeChallenge = btoa(String.fromCharCode(...new Uint8Array(hash)))
  .replace(/\+/g, '-')
  .replace(/\//g, '_')
  .replace(/=/g, '');

// Store verifier for callback
sessionStorage.setItem('pkce_verifier', codeVerifier);
```

**Google Button Component:**
```typescript
const handleGoogleLogin = async () => {
  try {
    const codeVerifier = generateCodeVerifier();
    const codeChallenge = await generateCodeChallenge(codeVerifier);
    const state = crypto.randomUUID();

    sessionStorage.setItem('pkce_verifier', codeVerifier);
    sessionStorage.setItem('oauth_state', state);

    const { data } = await api.post('/auth/google/url', { state, codeChallenge });
    window.location.href = data.authUrl;
  } catch (error) {
    setError('Failed to initiate Google login');
  }
};
```

## Tasks
- [ ] Create GoogleLoginButton component
- [ ] Implement PKCE code_verifier generation
- [ ] Implement code_challenge generation (SHA256)
- [ ] Store code_verifier in sessionStorage
- [ ] Call POST /api/auth/google/url endpoint
- [ ] Redirect to Google OAuth URL
- [ ] Create /auth/google/callback route component
- [ ] Extract authorization code from URL params
- [ ] Verify state parameter matches stored value
- [ ] Call POST /api/auth/google/callback with code and verifier
- [ ] Store tokens in authStore on success
- [ ] Redirect to /dashboard on success
- [ ] Display error message on failure
- [ ] Add Google logo and styling
- [ ] Test on mobile devices

## Testing
- [ ] Google button visible on login page
- [ ] Button click redirects to Google consent screen
- [ ] OAuth callback extracts code from URL
- [ ] State verification prevents CSRF attacks
- [ ] Successful login stores tokens and redirects
- [ ] Failed login displays error message
- [ ] PKCE verifier cleared after callback
- [ ] Works on Chrome, Firefox, Safari
- [ ] Mobile responsive

## Definition of Done
- Google login button functional
- PKCE security implemented correctly
- OAuth flow completes successfully
- Error handling works
- Mobile responsive

## Agent Model Used
[To be filled by dev agent]

## Dev Agent Record

### File List
- `apps/web/src/components/auth/GoogleLoginButton.tsx`
- `apps/web/src/pages/Auth/GoogleCallback.tsx`
- `apps/web/src/pages/Auth/Login.tsx` (updated)
- `apps/web/src/App.tsx` (add route)

### Change Log
[To be filled during implementation]
